---
title: "Analiza trga nafte"
author: "Luka Vidic"
output:
  pdf_document:
    latex_engine: xelatex
    includes:
      in_header: lib/styles.sty
---

Temo sem izbiral na področju, ki ga imam željo podrobneje spoznati. Kapitalski trgi zaradi svoje kompleksnosti ponujajo veliko količino podatkov, kar mi bo koristilo pri projektu, kjer bom na podlagi le teh poskušal analizirati dogajanje.
Glede na to da gre tukaj za zelo obširno temo, sem se odločil, da se podrobneje posvetim le specifični novici, ki vpliva na tako na ceno nafte, kot tudi na določene valutne tečaje. 

Kakšen je cilj analize?
=======================


Glavni cilj analize je poiskati vzorce odzivanja trgov, ki se ponavljajo ob objavi novice. Poskušal bom poiskati povezave med razliko napovedi analitikov in objavljeno količino ter odzivnostjo trga. V kolikor bom zaznal vzorce, ki se bodo ponavljali jih bom natančneje analiziral.

Dodatni cilji:
--------------

Dodatne cilje bom skušal doseči le v primeru, da bom dosegel glavni cilj. Za stranske cilje sem si zadal iskanje tako imenovanih "arbitraž" med različnimi trgovalnimi instrumenti ter razviti trgovalno strategijo, ki bi te "arbitraže" lahko koristila.


Za katero novico gre?
=====================

 Ameriška uprava za energetske informacije (U.S. Energy Information Administration oz. EIA) je glavna agencija Zveznega statističnega sistema Združenih držav Amerike (Federal Statistical System of the United States). Glavne naloge agencije so zbiranje, analiziranje in razširjanje energetskih informacij za pospeševanje oblikovanja dobrih politik, učinkovitosti trgov in javnega razumevanja energije ter njene povezanosti z gospodarstvom in okoljem. Programi EIA zajemajo podatke o zalogah premoga, nafte, zemeljskega plina, obnovljivih virov, električne ter jedrske energije.
 
 EIA tedensko, ponavadi vsako sredo ob 16:30, objavlja spremembo števila sodčkov surove nafte (Crude Oil Inventories), ki jo hranijo ameriška podjetja. Nivo zalog vpliva na ceno naftnih izdelkov, posledično se odraža sprememba tudi na vrednotenjih valut. Tukaj imam v mislih predvsem države (njihove valute), ki so močno odvisne od izvoza/uvoza naftnih derivatov.
 Poleg omenjene novice, ob istem času objavi še spremembo zalog destiliranih naftnih produktov (Distillate Inventories), spremembo zalog bencina (Gasoline Inventories) in pa količino izkoriščenih rafinerij (Refinery Utilization).
 


Priprava okolja:
================

Preden začnem s kakršno koli analizo, bom najprej prenesel vse potrebne knjižnice:
```{r setup}
source("lib/knjiznice.r", encoding = "UTF-8")
```


Pridobivanje podatkov:
======================

Prvo sem se odločil poiskati podatke za ceno surove nafte v različnih časovnih intervalih (1,2,5,10,15,30,60,300 sekund) ob objavi novice. Nato sem to ponovil še za tečaj ameriškega dolarja in kanadskega dolarja (USD/CAD).
Imel sem to srečo, da sem podatke našel že zbrane v obliki csv, ki sem jih skranil v `\podatki\timestamped`. Ko je bilo to shranjeno sem dodal še podatke napovedi in realiziranih količin zalog v mapo `\podatki\inventories.txt`

V primeru, da ne bi našel že zbranih podatkov, bi jih pridobil iz spletne strani <http://www.fasteconomicnews.com/fx_calendar.aspx> z uvozom knjižnice XML in uporabo funkcije `htmlTreeParse(naslov, encoding = "UTF-8", useInternal = TRUE)` bi poiskal željene podatke.


Urejanje podatkov:
====================

Podatke sem uredil s pomočjo regularnih izrazov in jih shranil kot `data.frame` z imeni spremenljivk sestavljenimi iz *datum/število sekund*. Za imena vrstic pa sem uporabil:
```{r uvoz, eval=FALSE}
source("uvoz/uvoz podatkov.r", encoding = "UTF-8")
```
 Oziroma:
```{r uvoz2, eval=FALSE}
# če bom potreboval imena
all_dates <- dir("podatki/timestamped")

poskusni_list <- list.dirs("podatki/timestamped")
# odstranim samega sebe
poskusni_list <- poskusni_list[2:388]
# odstranim še mape, ki držijo potrebne podatke. Ostanejo le še mape clcoil in usdcad
list_brez_svoje_mape <- poskusni_list[-seq(1,length(poskusni_list),3)]

# poberem imena kar z datumom skupaj, za boljšo preglednost in identifikacijo
proba <- list.files(path = list_brez_svoje_mape, pattern = ".html", full.names = TRUE)

ime <- gsub("^.*?/(\\d{2,4}.*?)\\/.*?(\\/.*?)\\.html","\\1\\2",proba)
# izbrišem še podvojene
ime <- unique(ime)


# ustvarim data.frame velikosti 9x149, kjer je prvi stolpec namenjen datumu,
# 2:5 so namenjeni clcoil in 6:9 so namenjeni usdcad

# USD/CAD sem napisal v inverzni obliki zaradi lepše vizualizacije

for (i in 1:length(ime)){

  assign("x", data.frame( "Date" = read.csv(proba[i])[1],
                          "OilOpen" = read.csv(proba[i])[2],
                          "OilHigh" = read.csv(proba[i])[4],
                          "OilLow" = read.csv(proba[i])[5],
                          "OilClose" = read.csv(proba[i])[3],
                          "CadOpen" = read.csv(proba[i+8])[2]^-1,
                          "CadHigh" = read.csv(proba[i+8])[4]^-1,
                          "CadLow" = read.csv(proba[i+8])[5]^-1,
                          "CadClose" = read.csv(proba[i+8])[3]^-1
                          ))
  names(x) <- c("Date", "OilOpen", "OilHigh", "OilLow", "OilClose", "CadOpen",
                "CadHigh", "CadLow", "CadClose")
  
  assign(ime[i], x)
  
  rm(x)
}
```

Sedaj ko imam podatke za formiranje grafov ter opravlanje analiz urejene, moram še urediti podatke o napovedih in realiziranih ocenah nafte.




A Second Level Header
---------------------

Now is the time for all good men to come to
the aid of their country. This is just a
regular paragraph.

The quick brown fox jumped over the lazy
dog's back.

### Header 3

> This is a blockquote.
> 
> This is the second paragraph in the blockquote.
>
> ## This is an H2 in a blockquote
